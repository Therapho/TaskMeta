@using TaskMeta.Shared.Models
@rendermode InteractiveServer

@if (_taskActivityList != null && _taskWeek != null)
{

    <table class="taskChart">
        <tr>
            <th> </th>
            <th>S</th>
            <th>M</th>
            <th>T</th>
            <th>W</th>
            <th>T</th>
            <th>F</th>
            <th>S</th>
        </tr>
        @if (TaskDefinitionList != null)
        {
            foreach (TaskDefinition taskDefinition in TaskDefinitionList)
            {
                <tr>
                    <td>
                        @{
                            if (taskDefinition != null)
                            {
                                <span>@taskDefinition.Description</span>
                            }
                        }
                    </td>
                    @for (int d = 0; d < 7; d++)
                    {
                        {
                            DateOnly currentDay = _taskWeek.WeekStartDate.AddDays(d);

                            var task = _taskActivityList!.Where(t => t.TaskDefinitionId == taskDefinition!.Id && t.TaskDate == currentDay).FirstOrDefault();
                            {
                                if(task != null)
                                {<td>
                                    <FluentCheckbox @bind-value="task!.Complete" ReadOnly="@locked" 
                                    Class="checkbox" Style="--base-height-multiplier: 20;" bind-value:after="@(()=>HandleChange(task!))" />
                                </td>}
                            }
                        }
                    }
                </tr>
            }
        }
    </table>
    <hr />
    <FluentGrid>
        <FluentGridItem xs="6">
            <strong>Total: </strong> @_taskWeek.Value.ToString("C")
        </FluentGridItem>
        <FluentGridItem xs="6">
            @if (CanApprove)
            {
                <FluentButton @onclick="HandleApprove">Approve</FluentButton>
            }
        </FluentGridItem>
    </FluentGrid>

}

